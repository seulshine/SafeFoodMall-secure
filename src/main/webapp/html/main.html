<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>식품정보</title>
<!-- bootstrap 3.3.7이하는 jQuery 1.x, 3.3.7이상으로 업그레이드 필요 -->
<link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

<!-- 부가적인 테마 -->
<link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css">
<!-- jQuery 추가 -->
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<!-- 합쳐지고 최소화된 최신 자바스크립트 -->
<script
	src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>


<style>
.jumbotron {
	height: 400px;
	background: white;
	background-image: url('https://images.unsplash.com/photo-1543352634-a1c51d9f1fa7?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&w=1000&q=80');
	background-repeat: no-repeat;
	background-position: center;
	background-size: cover;
	padding-top: 120px;
	margin-top: 10px;
}

#search {
	background: gray !important;
	color: white !important;
	padding: 20px 10px;
}

.container {
	margin-bottom: 10px;
}

@import url('https://fonts.googleapis.com/css?family=Jua&display=swap');
#title {
 	font-family: 'Jua', sans-serif;
}

#navbar {
	padding-right: 20px;
}

footer {
	background: #f0f0f0;
	padding: 5px 15px 10px 15px;
}

#itemTxt {
	overflow: hidden;
	text-overflow: ellipsis;
	white-space: nowrap;
	height: 20px;
}


</style>
</head>
<body>
    <div class="container">
		<!-- Modal -->
		<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
			<div class="modal-dialog modal-sm">
				<div class="modal-content">
					<div class="modal-body">
						<form class="form-signin">
							<h2 class="form-signin-heading">Log in</h2>
							<label for="inputEmail" class="sr-only">아이디</label> 
							<input type="text" id="inputId" class="form-control" placeholder="아이디" required="" autofocus=""> 
							<label for="inputPassword" class="sr-only">비밀번호</label> 
							<input type="password" id="inputPassword" class="form-control" placeholder="비밀번호" required="">
						</form>
					</div>
					<div class="modal-footer">
					<button onclick="login()" class="btn btn-lg btn-primary btn-block" type="submit">Log in</button>
					</div>
				</div>
			</div>
		</div>
	</div>
	<nav class="navbar">
		<div class="container">
			<div id="navbar" class="navbar-collapse collapse navbar-inverse" aria-expanded="false" style="height: 1px;">
				<ul class="nav navbar-nav navbar-right">
		 			<li id="Loginout"><button type="button" class="btn btn-link" data-toggle="modal" data-target="#myModal">Log in</button></li>
					<li id="sign"><button type="button" class="btn btn-link" onclick="location.href='signup.html'">sign up</button></li>
				</ul>
			</div>
		</div>
		
		
		<div class="container">
			<div class="navbar-header">
				<img alt="ssafy"
					src="http://edu.ssafy.com/asset/images/header-logo.jpg">
			</div>
			<div id="navbar" class="navbar-collapse collapse"
				aria-expanded="false" style="height: 1px;">
				<ul class="nav navbar-nav">
					<li class="active"><a href="#">공지사항</a></li>
					<li><a href="#">상품 정보</a></li>
					<li><a href="#">베스트 섭취 정보</a></li>
					<li><a href="#">내 섭취 정보</a></li>
					<li><a href="#">예상 섭취 정보</a></li>
				</ul>
				<form class="navbar-form navbar-right">
					<input type="text" class="form-control" placeholder="Search...">
				</form>
			</div>
			<!--/.nav-collapse -->
		</div>
	</nav>
	<!-- Main jumbotron for a primary marketing message or call to action -->
	<div class="jumbotron">
		<div class="container">
			<div id="title">
				<h1>
					WHAT WE <strong>PROVIDE</strong>
				</h1>
				<hr>
				<p>건강한 삶을 위한 먹거리 프로젝트</p>
			</div>
		</div>
	</div>
	<div class="container" id="search">
		<div class="row">
			<div class="col-md-2 col-md-offset-3">
				<div>
					<label for="condition">검색 조건</label> <select id="type"
						class="form-control">
						<option>상품명</option>
						<option>재료</option>
						<option>제조사</option>
					</select>
				</div>
			</div>
			<div class="col-md-3">
				<form>
					<div class="form-group">
						<label for="search">검색 단어</label> <input id="input" type="text"
							class="form-control">
					</div>
				</form>
			</div>
			<div class="col-md-1">
				<br>
				<button id="keywordGet" type="button" class="btn btn-info">검색</button>
			</div>
			<div class="col-md-3"></div>
		</div>
	</div>

	<div class="container">
		<div id="getList"></div>
		<hr>
		<footer>
			<h3>Find Us</h3>
			<hr>
			<p>
				<span class="glyphicon glyphicon-pushpin" aria-hidden="true"></span>
				(SSAFY) 서울시 강남구 ㅇㅇ로 멀티스퀘어<br> <span
					class="glyphicon glyphicon-earphone" aria-hidden="true"></span>
				1544-0000<br> <span class="glyphicon glyphicon-send"
					aria-hidden="true"></span> ssafy@ssafy.com
			</p>
			<div>Copyright.  ssafy2 허대원 한수연</div>
		</footer>
	</div>
	<!-- /container -->
</body>
<script>

	let foods;
	$.ajax({
		url : "res/foodInfo.json",
		success : function(data) {
			foods = data;
		},
		error : function() {
			alert("error");
		}
	});
	
	let foodNutrs;
	$.ajax({
		url : "res/FoodNutritionInfo.json",
		success : function(data) {
			foodNutrs = data.response.body.items.item;
		},
		error : function() {
			alert("error");
		}
	});
	
	
	$("#keywordGet").on("click", function() {
				$("#getList").html("");
				let $name = $('#input').val();
				let $type = $('#type').val();
				foods.forEach(function(elt, index) {
					console.log(index + 1 + " " + elt.name)
					if ($type == "상품명"){
						if (elt.name.match($name)) {
							$("#getList").html($("#getList").html() + '<div id="item'+ index +'" class="row"></div><hr>');
							$("#item" + index).html($("#item" + index).html() + '<div id="itemImg'+ index +'" class="col-md-3">' );
							$("#itemImg" + index).html($("#itemImg" + index).html() + '<img src="' + elt.image + '"  width="80%">');
							$("#item" + index).html($("#item" + index).html() + '<div id="itemTxt'+ index +'" class="col-md-9">');
							$("#itemTxt" + index).html($("#itemTxt" + index).html() + '<h2>' + elt.name + '</h2>');
							let maText = elt.material;
							if (elt.material.length >= 200)
								maText = elt.material.substr(0, 200) + ' ...';
							$("#itemTxt" + index).html($("#itemTxt" + index).html() + '<p>' + maText + '<p>');
							$("#itemTxt" + index).html($("#itemTxt" + index).html() + 
									'<p><a class="btn btn-info" href="http://localhost:8080/safefood_web_front/detail.html" role="submit" onclick="goDetail(' + index + ');">Viewdetails&raquo;</a></p>');
}
					} else if ($type == "재료"){
						if (elt.material.match($name)) {
							$("#getList").html($("#getList").html() + '<div id="item'+ index +'" class="row"></div><hr>');
							$("#item" + index).html($("#item" + index).html() + '<div id="itemImg'+ index +'" class="col-md-3">' );
							$("#itemImg" + index).html($("#itemImg" + index).html() + '<img src="' + elt.image + '"  width="80%">');
							$("#item" + index).html($("#item" + index).html() + '<div id="itemTxt'+ index +'" class="col-md-9">');
							$("#itemTxt" + index).html($("#itemTxt" + index).html() + '<h2>' + elt.name + '</h2>');
							let maText = elt.material;
							if (elt.material.length >= 200)
								maText = elt.material.substr(0, 200) + ' ...';
							$("#itemTxt" + index).html($("#itemTxt" + index).html() + '<p>' + maText + '<p>');
							$("#itemTxt" + index).html($("#itemTxt" + index).html() + 
									'<p><a class="btn btn-info" href="http://localhost:8080/safefood_web_front/detail.html" role="submit" onclick="goDetail(' + index + ');">Viewdetails&raquo;</a></p>');
						}
					} else if ($type == "제조사"){
						if (elt.maker == $name) {
							$("#getList").html($("#getList").html() + '<div id="item'+ index +'" class="row"></div><hr>');
							$("#item" + index).html($("#item" + index).html() + '<div id="itemImg'+ index +'" class="col-md-3">' );
							$("#itemImg" + index).html($("#itemImg" + index).html() + '<img src="' + elt.image + '"  width="80%">');
							$("#item" + index).html($("#item" + index).html() + '<div id="itemTxt'+ index +'" class="col-md-9">');
							$("#itemTxt" + index).html($("#itemTxt" + index).html() + '<h2>' + elt.name + '</h2>');
							let maText = elt.material;
							if (elt.material.length >= 200)
								maText = elt.material.substr(0, 200) + ' ...';
							$("#itemTxt" + index).html($("#itemTxt" + index).html() + '<p>' + maText + '<p>');
							$("#itemTxt" + index).html($("#itemTxt" + index).html() + 
									'<p><a class="btn btn-info" href="http://localhost:8080/safefood_web_front/detail.html" role="submit" onclick="goDetail(' + index + ');">Viewdetails&raquo;</a></p>');
						}
					}
				})
			})
		$('#input').keypress(function(e){
	     	if ( e.which == 13 ) {
		         $('#keywordGet').click();
		         return false;
	     	}
		});
			
			
		function goDetail(index) {
			foods.forEach(function(elt, idx) {
				if (index == idx){
					sessionStorage.setItem('name', elt.name);
					sessionStorage.setItem('maker', elt.maker);
					sessionStorage.setItem('material', elt.material);
					sessionStorage.setItem('img', elt.image);
				}
			});

			foodNutrs.forEach(function(elt, idx) {
				if (index == idx){
					sessionStorage.setItem('SERVING_WT', elt.SERVING_WT);
					sessionStorage.setItem('NUTR_CONT1', elt.NUTR_CONT1);
					sessionStorage.setItem('NUTR_CONT2', elt.NUTR_CONT2);
					sessionStorage.setItem('NUTR_CONT3', elt.NUTR_CONT3);
					sessionStorage.setItem('NUTR_CONT4', elt.NUTR_CONT4);
					sessionStorage.setItem('NUTR_CONT5', elt.NUTR_CONT5);
					sessionStorage.setItem('NUTR_CONT6', elt.NUTR_CONT6);
					sessionStorage.setItem('NUTR_CONT7', elt.NUTR_CONT7);
					sessionStorage.setItem('NUTR_CONT8', elt.NUTR_CONT8);
					sessionStorage.setItem('NUTR_CONT9', elt.NUTR_CONT9);
				}
			});
		}
			
		function login() {
			$("#Loginout").html('<button type="button" class="btn btn-link" onclick="logout()">Log out</button>');
			$("#sign").html('<button type="button" class="btn btn-link" onclick="location.href=\'modify.html\'">Modify</button>');
			$("#myModal").modal("hide");
		}
		
		function logout() {
			$("#Loginout").html('<button type="button" class="btn btn-link" data-toggle="modal" data-target="#myModal">Log in</button>');
			$("#sign").html('<button type="button" class="btn btn-link" onclick="location.href=\'signup.html\'">sign up</button>');
		}

//			href="http://localhost:8080/safefood_web_front/modify.html"
// 		<li><button id="mainLogin" type="button" class="btn btn-link" data-toggle="modal" data-target="#myModal">Log in</button></li>
// 		<li><button id="signup" type="button" class="btn btn-link">sign up</button></li>
	// END:
</script>
</html>